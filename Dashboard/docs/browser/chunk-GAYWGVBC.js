import{S as m,Wb as v,X as k,f as g,j as h,r as p}from"./chunk-XKOZPAWX.js";var a={BASE_URL:"https://tazkaritbackend.fly.dev"};var c=class extends Error{};c.prototype.name="InvalidTokenError";function B(o){return decodeURIComponent(atob(o).replace(/(.)/g,(s,e)=>{let t=e.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function _(o){let s=o.replace(/-/g,"+").replace(/_/g,"/");switch(s.length%4){case 0:break;case 2:s+="==";break;case 3:s+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return B(s)}catch{return atob(s)}}function $(o,s){if(typeof o!="string")throw new c("Invalid token specified: must be a string");s||(s={});let e=s.header===!0?0:1,t=o.split(".")[e];if(typeof t!="string")throw new c(`Invalid token specified: missing part #${e+1}`);let n;try{n=_(t)}catch(r){throw new c(`Invalid token specified: invalid base64 for part #${e+1} (${r.message})`)}try{return JSON.parse(n)}catch(r){throw new c(`Invalid token specified: invalid json for part #${e+1} (${r.message})`)}}var H=(()=>{class o{constructor(e){this._HttpClient=e,this.approvedEventsSubject=new h([]),this.approvedEvents$=new h([])}getusers(){let e=localStorage.getItem("userToken");return this._HttpClient.get(`${a.BASE_URL}/user/allusers`,{headers:{Authorization:`Bearer ${e}`}})}login(e){return this._HttpClient.post(`${a.BASE_URL}/auth/login`,e)}saveUserData(){localStorage.getItem("userToken")!==null&&$(localStorage.getItem("userToken"))}getevents(){let e=localStorage.getItem("userToken");return this._HttpClient.get(`${a.BASE_URL}/api/events`,{headers:{Authorization:`Bearer ${e}`}}).pipe(p(t=>t.events||[]))}searchEvents(e){let t=localStorage.getItem("userToken");return this._HttpClient.get(`${a.BASE_URL}/api/events/search?q=${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${t}`}}).pipe(p(n=>n.events||[]))}getEventsWithPagination(e=1,t=10){let n=localStorage.getItem("userToken");return this._HttpClient.get(`${a.BASE_URL}/api/events?page=${e}&limit=${t}`,{headers:{Authorization:`Bearer ${n}`}})}getTickets(){let e=localStorage.getItem("userToken");return this._HttpClient.get(`${a.BASE_URL}/api/tickets`,{headers:{Authorization:`Bearer ${e}`}})}getnotfigation(){let e=localStorage.getItem("userToken");return this._HttpClient.get(`${a.BASE_URL}/user/notifications`,{headers:{Authorization:`Bearer ${e}`}})}geteventById(e){return this._HttpClient.get(`${a.BASE_URL}/api/events/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("userToken")}`}})}updateEvent(e,t){let n=localStorage.getItem("userToken");return this._HttpClient.patch(`${a.BASE_URL}/api/events/edit/${t}`,e,{headers:{Authorization:`Bearer ${n}`}})}deleteEvent(e){let t=localStorage.getItem("userToken");return this._HttpClient.delete(`${a.BASE_URL}/api/events/${e}`,{headers:{Authorization:`Bearer ${t}`}})}createEvent(e){let t=localStorage.getItem("userToken");return this._HttpClient.post(`${a.BASE_URL}/api/events`,e,{headers:{Authorization:`Bearer ${t}`}})}getEventsByCategory(e){let t=localStorage.getItem("userToken");return this._HttpClient.get(`${a.BASE_URL}/api/events?category=${e}`,{headers:{Authorization:`Bearer ${t}`}}).pipe(p(n=>n.events||[]))}getUpcomingEvents(){let e=localStorage.getItem("userToken");return this._HttpClient.get(`${a.BASE_URL}/api/events?upcoming=true`,{headers:{Authorization:`Bearer ${e}`}}).pipe(p(t=>t.events||[]))}updateEventStatus(e,t){let n=localStorage.getItem("userToken");return this._HttpClient.patch(`${a.BASE_URL}/api/events/${e}/status`,{status:t},{headers:{Authorization:`Bearer ${n}`}})}uploadEventImage(e,t){let n=localStorage.getItem("userToken"),r=new FormData;return r.append("image",t),this._HttpClient.post(`${a.BASE_URL}/api/events/${e}/images`,r,{headers:{Authorization:`Bearer ${n}`}})}deleteEventImage(e,t){let n=localStorage.getItem("userToken");return this._HttpClient.delete(`${a.BASE_URL}/api/events/${e}/images`,{headers:{Authorization:`Bearer ${n}`},body:{imageUrl:t}})}approveEvent(e,t){let n=localStorage.getItem("userToken");return this._HttpClient.post(`${a.BASE_URL}/user/approveEvent`,{id:e,approved:t},{headers:{Authorization:`Bearer ${n}`}})}getEventTicketStats(){return new g(e=>{this.getevents().subscribe(t=>{this.getTickets().subscribe(n=>{this.getusers().subscribe(r=>{let i=this.calculateTicketStats(t,n,r);e.next(i),e.complete()})})})})}getEventStatistics(){return new g(e=>{this.getevents().subscribe(t=>{let n={totalEvents:t.length,upcomingEvents:t.filter(r=>r.upcoming).length,publishedEvents:t.filter(r=>r.status==="published").length,approvedEvents:t.filter(r=>r.approved).length,totalAttendees:t.reduce((r,i)=>r+i.currentAttendees,0),totalCapacity:t.reduce((r,i)=>r+i.maxAttendees,0),categories:[...new Set(t.map(r=>r.category))],averageAttendance:t.length>0?Math.round(t.reduce((r,i)=>r+i.currentAttendees,0)/t.length):0};e.next(n),e.complete()})})}calculateTicketStats(e,t,n){return e.map(r=>{let i=t.filter(l=>String(l.eventId)===String(r._id)),S=i.filter(l=>l.status==="confirmed").length,A=i.filter(l=>l.status==="pending").length,u=S+A,f=r.maxAttendees-u,d=r.maxAttendees>0?Math.round(u/r.maxAttendees*100):0,E=100-d;return{eventId:r._id,eventName:r.title,eventDate:r.startDate,eventLocation:r.location,totalTickets:r.maxAttendees,reservedTickets:u,availableTickets:Math.max(0,f),reservedPercentage:d,availablePercentage:E}})}static{this.\u0275fac=function(t){return new(t||o)(k(v))}}static{this.\u0275prov=m({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{H as a};
